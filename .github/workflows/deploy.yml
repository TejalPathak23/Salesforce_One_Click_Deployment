name: Deploy to New Salesforce Org

# Trigger on manual dispatch (or you can use push events)
on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout your repository
      - name: Checkout Code
        uses: actions/checkout@v3

      # Step 2: Install Salesforce CLI
      - name: Install Salesforce CLI
        run: |
          npm install -g sfdx-cli

      # Step 3: Set up the SFDX Auth URL
      - name: Set up SFDX Authentication
        run: |
          echo "${{ secrets.SFDC_AUTH_URL }}" > sfdx-auth-url.txt
          sfdx force:auth:sfdxurl:store -f sfdx-auth-url.txt -a MyNewOrg

      # (Optional) Step 4: Display org info for verification
      - name: Display Org Info
        run: sfdx force:org:display -u MyNewOrg --verbose

      # Step 5: Deploy the metadata from your repository to the target org
      - name: Deploy Metadata
        run: sfdx force:source:deploy -u MyNewOrg -p force-app --wait 10 --testlevel RunLocalTests
